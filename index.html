<!DOCTYPE html>
  <head>
    <meta charset="utf-8">
    <title></title>
  </head>
  <body>
	<p id="p"></p>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="http://d3js.org/topojson.v2.min.js"></script>
	<script src="https://d3js.org/d3-geo.v1.min.js"></script>
	<script src="https://d3js.org/d3-geo-projection.v1.min.js"></script>
    <script>

      taxiArray=[];
      inspectionArray=[];

      d3.queue()
      .defer(d3.csv, "June1Taxi.txt")
      .defer(d3.csv, "ManhattanInspect.txt")
	  .defer(d3.json, "nyc.json")
      .await(function (error, rawTaxi, rawInspect, nyc) {
        
        console.log("Code in the call-back function is only executed when every data file loads.");
		//rawTaxi.length
        for(var i=0;i<100;i++){//longitude is x value, latitude is y
          longitude = parseFloat(rawTaxi[i].dropoff_longitude);
          latitude = parseFloat(rawTaxi[i].dropoff_latitude);
          dropTime = (rawTaxi[i].dropoff_datetime);

          taxiArray.push({ longitude: longitude, latitude: latitude, dropTime: dropTime });
            }

        console.log(taxiArray);

        //rawInspect.length
        for(var i=0;i<100;i++){//longitude is x value, latitude is y
          longitude = parseFloat(rawInspect[i].Longitude);
          latitude = parseFloat(rawInspect[i].Latitude);
          businessName = (rawInspect[i].Business_Name);
          inspectionResult = (rawInspect[i].Inspection_Result);
          industry = (rawInspect[i].Industry);

          inspectionArray.push({ longitude: longitude, latitude: latitude, businessName: businessName, inspectionResult: inspectionResult, industry: industry });
            }

        console.log(inspectionArray);
		
		var svg = d3.select("#p").append("svg").attr("height",1100).attr("width",500);
		
		var projection = d3.geoMercator().center([-73.94, 40.70])
				.scale(200000);
        
		
		projection.fitExtent([[0,0], [svg.attr("width"), svg.attr("height")]], nyc);
				
		var pathGenerator = d3.geoPath().projection(projection);
		var p = svg.append("g");
		
		p.selectAll(".state")
		.data(nyc.features)
		.enter().append("path")
		.attr("d", pathGenerator)
		.attr("transform", "translate(-200,200) rotate(-27)")
		.attr("fill","grey");
		
        var dots = svg.selectAll("circle").data(taxiArray);
        dots.enter().append("circle").attr("r", 2).style("fill", "blue")
        .attr("cx", function(d) { console.log(projection([d.longitude,d.latitude])); return projection([d.longitude,d.latitude])[0];})
        .attr("cy", function(d) { return projection([d.longitude,d.latitude])[1]; })
		.attr("transform", "translate(-200,200) rotate(-27)");
      });

      function distance(lat1, long1, lat2, long2){//returns distance in feet
        latDiff=lat1-lat2;
        latDiff=latDiff*364320 //364320=69 miles in feet, 1 degree of Lat is about 69 miles
        longDiff=long1-long2;
        longDiff=longDiff*279840 //279840=53 miles in feet, 1 degree of long is about 53 miles at 40 degrees north

        return Math.sqrt(Math.pow(latDiff, 2)+ Math.pow(longDiff, 2));

      }


    </script>
  </body>
</html>