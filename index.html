<!DOCTYPE html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <link rel="stylesheet" type="text/css" href="style.css">
  </head>
  <body>
	<p id="p">
		<label for="time">Time</label>
		<input style="width: 300px;" type="range" id="time" min="0" value="0" max="1440" step="1">
	</p>
	</p>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="http://d3js.org/topojson.v2.min.js"></script>
	<script src="https://d3js.org/d3-geo.v1.min.js"></script>
	<script src="https://d3js.org/d3-geo-projection.v1.min.js"></script>
    <script>
	
	
   	var timeDict = {};
   	var timeDict5 = {};
   	var timeDict8 = {};
   	var timeDict12 = {};
   	var timeDict15 = {};
	weatherArray=[];	
	
	var parseTaxi = function(row){
		
	    dropLong = parseFloat(row.dropoff_longitude);
	    dropLat = parseFloat(row.dropoff_latitude);
	    dropTime = row.dropoff_datetime;
	    pickLong = parseFloat(row.pickup_longitude);
	    pickLat = parseFloat(row.pickup_latitude);
	    pickTime = row.pickup_datetime;
	    fare = parseFloat(row.payment_amount);
	    dist = parseFloat(row.trip_distance);
	  
	  var obj = { dropLong: dropLong, dropLat: dropLat, dropTime: dropTime, pickLong: pickLong, pickLat: pickLat, pickTime: pickTime, fare: fare, dist: dist};
      
      var day = pickTime.split(' ')[0];
	  var time = pickTime.split(' ')[1];
	  var slots =  time.split(':');
	  var tot = parseInt(slots[0])*60 + parseInt(slots[1]);

	  switch (day){
	  	case "2016-06-05":
	  		if (!(tot in timeDict5)){
		  		timeDict5[tot] = [obj];
	  		}else {
		  		timeDict5[tot].push(obj);
	  		}
	  		break;
	  	case "2016-06-08":
	  		if (!(tot in timeDict8)){
		  		timeDict8[tot] = [obj];
	  		}else {
		  		timeDict8[tot].push(obj);
	  		}
	  		break;
	  	case "2016-06-12":
	  		if (!(tot in timeDict12)){
		  		timeDict12[tot] = [obj];
	  		}else {
		  		timeDict12[tot].push(obj);
	  		}
	  		break;
	  	case "2016-06-15":
	  		if (!(tot in timeDict15)){
		  		timeDict15[tot] = [obj];
	  		}else {
		  		timeDict15[tot].push(obj);
	  		}
	  		break;
	  }
	  
	  if (!(tot in timeDict)){
		  timeDict[tot] = [obj];
	  }else {
		  timeDict[tot].push(obj);
	  }
	};
	
	var parseWeather = function(row){
        date = parseFloat(row.DATE);
        precip = parseFloat(row.PRCP);
        tempAve = parseFloat(row.TAVG);
        tempMax = parseFloat(row.TMAX);;
        tempMin = parseFloat(row.TMIN);;

        weatherArray.push({ date: date, precip: precip, tempAve: tempAve, 
			tempMax: tempMax, tempMin: tempMin });
	};
		
      
      d3.queue()
      .defer(d3.json, "nyc.json")
      .defer(d3.csv, "June5Taxi.csv", parseTaxi)
      .defer(d3.csv, "June8Taxi.csv", parseTaxi)
      .defer(d3.csv, "June12Taxi.csv", parseTaxi)
      .defer(d3.csv, "June15Taxi.csv", parseTaxi)
      .defer(d3.csv, "WeatherData.csv", parseWeather)
      .await(function (error, nyc, taxi5, taxi8, taxi12, taxi15, weather) {
        console.log("Code in the call-back function is only executed when every data file loads.");

        console.log(error);

		var svg = d3.select("#p").append("svg").attr("height",1100).attr("width",500);
		
		var projection = d3.geoMercator().center([-73.94, 40.70])
				.scale(200000);
        
		projection.fitExtent([[0,0], [svg.attr("width"), svg.attr("height")]], nyc);
				
		var pathGenerator = d3.geoPath().projection(projection);
		var p = svg.append("g");
		
		p.selectAll(".state")
		.data(nyc.features)
		.enter().append("path")
		.attr("d", pathGenerator)
		.attr("transform", "translate(-200,200) rotate(-27)")
		.attr("fill","grey");


		//Tooltip element for hover feature

		var tooltip = d3.select("body")
			.append("div")
			.attr("id", "tooltip")
			.style("position", "absolute")
			.style("z-index", "10")
			.style("visibility", "hidden")
			.text("");

		
		var slide = d3.select("#time");
		slide.on("input", function(){
			t = this.value;
			pickDots(t);

		});

		function pickDots(t){
	    /* 	var dropDots = svg.selectAll(".dropoffs").data(timeDict[t]);
			dropDots.exit().remove();
			dropDots.enter().append("circle").attr("class", "dropoffs").attr("r", 3).style("fill", "blue")
			.attr("cx", function(d) { 
				if ((d.dropLat > 1.895121486*d.dropLong+180.9002959) && (d.dropLat > .0550037105*d.dropLong+44.77000868) && (d.dropLat < 1.547301526*d.dropLong+155.2683443) &&  (d.dropLat < -76.50437318*d.dropLong-5615.435765) && (d.pickLat > 1.895121486*d.pickLong+180.9002959) && (d.pickLat > .0550037105*d.pickLong+44.77000868) && (d.pickLat < -76.50437318*d.pickLong-5615.435765) && (d.pickLat < 1.547301526*d.pickLong+155.2683443)){
					return projection([d.dropLong,d.dropLat])[0];
				}
			})
			.attr("cy", function(d) { 
				if ((d.dropLat > 1.895121486*d.dropLong+180.9002959) && (d.dropLat > .0550037105*d.dropLong+44.77000868) && (d.dropLat < 1.547301526*d.dropLong+155.2683443) &&  (d.dropLat < -76.50437318*d.dropLong-5615.435765) && (d.pickLat > 1.895121486*d.pickLong+180.9002959) && (d.pickLat > .0550037105*d.pickLong+44.77000868) && (d.pickLat < -76.50437318*d.pickLong-5615.435765) && (d.pickLat < 1.547301526*d.pickLong+155.2683443)){
					return projection([d.dropLong,d.dropLat])[1];
				}
			})
			.on("mouseover", function(d){return tooltip.style("visibility", "visible").text("Time: " + d.pickTime + "\nDistance: " + d.dist +"\nFare: " + d.fare + "\npickLat: " + d.pickLat + "\npickLong: " + d.pickLong + "\ndropLat: " + d.dropLat + "\ndropLong: " + d.dropLong); })
			.on("mousemove", function(){return tooltip.style("top", (event.pageY-10)+"px").style("left", (event.pageX+10)+"px");})
			.on("mouseout", function(){return  tooltip.style("visibility", "hidden"); })
			.attr("transform", "translate(0,200) rotate(-27)");*/

			var pickDots = svg.selectAll(".pickups").data(timeDict[t]);
			pickDots.exit().remove();
			pickDots.enter().append("circle").attr("class", "pickups").attr("r", 3).style("fill", "red")
			.attr("cx", function(d) { 
				if ((d.dropLat > 1.895121486*d.dropLong+180.9002959) && (d.dropLat > .0550037105*d.dropLong+44.77000868) && (d.dropLat < 1.547301526*d.dropLong+155.2683443) && (d.dropLat < -76.50437318*d.dropLong-5615.435765) && (d.pickLat > 1.895121486*d.pickLong+180.9002959) && (d.pickLat > .0550037105*d.pickLong+44.77000868) &&  (d.pickLat < -76.50437318*d.pickLong-5615.435765) && (d.pickLat < 1.547301526*d.pickLong+155.2683443)){
					return projection([d.pickLong,d.pickLat])[0];
				}
			})
			.attr("cy", function(d) { 
				if ((d.dropLat > 1.895121486*d.dropLong+180.9002959) && (d.dropLat > .0550037105*d.dropLong+44.77000868) && (d.dropLat < 1.547301526*d.dropLong+155.2683443) &&  (d.dropLat < -76.50437318*d.dropLong-5615.435765) && (d.pickLat > 1.895121486*d.pickLong+180.9002959) && (d.pickLat > .0550037105*d.pickLong+44.77000868) && (d.pickLat < -76.50437318*d.pickLong-5615.435765) && (d.pickLat < 1.547301526*d.pickLong+155.2683443)){
					return projection([d.pickLong,d.pickLat])[1];
				}
			})
			.on("mouseover", function(d){return tooltip.style("visibility", "visible").text("Time: " + d.pickTime + "\nDistance: " + d.dist +"\nFare: " + d.fare + "\npickLat: " + d.pickLat + "\npickLong: " + d.pickLong + "\ndropLat: " + d.dropLat + "\ndropLong: " + d.dropLong);})
			.on("mousemove", function(){return tooltip.style("top", (event.pageY-10)+"px").style("left", (event.pageX+10)+"px");})
			.on("mouseout", function(){return tooltip.style("visibility", "hidden");})
			.attr("transform", "translate(-200,200) rotate(-27)");
		}














      });

      
    </script>
  </body>
</html>